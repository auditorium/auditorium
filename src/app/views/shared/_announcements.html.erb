<% if params[:action].eql? 'index' %>
  <header>
    <h2>
      <%= t('groups.show.announcements.header') %>
      <small><%= link_to @group.title, group_path(@group) %></small>
    </h2>
  </header>
<% else %>
  <header>
  <h2>
    <%= t('groups.show.announcements.header') %>
  </h2>
</header>
<% end %>

<%= form_for([@group, @announcement = Announcement.new]) do |f| %>
  <ul class="no-style announcement">
    <li class="input-fields" class="input-fields">
      <%= f.label :subject, t('forms.label.subject'), class: 'accessibility' %>
      <%= f.text_field :subject, placeholder: t('announcements.input.new') %>
    </li>
    <div id='new-announcement-fields' data-id='new-announcement-fields'>
      <%= render 'shared/new_announcement_fields', f: f %>
    </div>  
  </ul>
<% end %>

<ul class="posts condensed">
  
<% limit ||= nil%>

<% @group.announcements.order(last_activity: :desc, updated_at: :desc).limit(limit).each_with_index do |announcement| %>
  <li class="announcement">
    <div class="content"> 
    <span class="rating"><%= announcement.rating %></span>
    <span class="title"><h2><%= link_to truncate(announcement.subject, length: 150), announcement %></h2></span>

  </div>
  <div class="footer hide-for-small">
    <span class="post-details">
      <%= link_to announcement.group.title, group_path(announcement.group), class: 'group-link' %> &middot;
      <%= pluralize(announcement.views, 'view') %> &middot;
      <% if announcement.class.name.eql? 'Question' %><%= pluralize(announcement.answers.size, 'answer') %> &middot;<% end %>
      <%= pluralize(announcement.comments.size, 'comment') %>
    </span>
    <span class="right">
      <span class="created_at"><%= l(announcement.created_at, format: :short) %></span>
      <% if can? :manage, announcement %> 
        <span class="actions">
          &middot;
          <%= link_to fa_icon('pencil', text: 'edit'), edit_announcement_path(announcement), alt: "#{t('posts.actions.edit')}", title: "#{t('posts.actions.edit')}" %> &middot;
          <%= link_to fa_icon('times', text: 'remove'), announcement, alt: "#{t('announcements.actions.delete')}", title: "#{t('posts.actions.edit')}", method: :delete, confirm: 'Are you sure to delete this post?' %>
        </span>
      <% end %>
    </span>
  </div>
  </li>
<% end %>
</ul>  

<% unless limit.nil? %>
  <span class="right"><small><%= link_to t('announcements.show_all'), group_announcements_path(@group) %></small></span>
<% end %>